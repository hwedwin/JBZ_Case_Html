<div id="page-wrapper">
    <ol class="breadcrumb">
        <li><a href="index.html">首页</a></li>
        <li><a href="javascript:;" onclick="srcpage('view-platform/store_list.html')">门店管理</a></li>
        <li class="active">修改门店信息</li>
    </ol>
    <div class="row">
        <div class="col-lg-6">
            <div class="input-group">
                <span class="input-group-addon">门店名称</span>
                <input type="text" class="form-control" placeholder="请填写门店名称" id="store_name">
            </div>
        </div>
        <div class="col-lg-6">
            <div class="input-group">
                <span class="input-group-addon">手机号码</span>
                <input type="text" class="form-control" placeholder="请填写手机号">
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-6">
            <div class="input-group">
                <span class="input-group-addon">微信昵称</span>
                <input type="text" class="form-control" placeholder="请填写微信昵称">
            </div>
        </div>
        <div class="col-lg-6">
            <div class="input-group">
                <span class="input-group-addon">OPENID</span>
                <input type="text" class="form-control" placeholder="OLEBMT1DV3OAUXEQI4SE2URLAE1W">
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-6">
            <div class="input-group">
                <span class="input-group-addon">邮箱地址</span>
                <input type="text" class="form-control" placeholder="请填写邮箱地址">
                <span class="input-group-addon">@</span>
                <input type="text" class="form-control" placeholder="请填写邮箱地址">
            </div>
        </div>
        <div class="col-lg-6">
            <div class="input-group">
                <span class="input-group-addon">座机号</span>
                <input type="text" class="form-control" placeholder="0731">
                <span class="input-group-addon">~</span>
                <input type="text" class="form-control" placeholder="88888888">
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-8">
            <div class="row">
                <div class="col-lg-12">
                    <div class="input-group">
                        <span class="input-group-btn">
                            <a class="btn btn-default file_btn" onclick="javascript:;">
                                上传形象
                                <input name="" class="file_input" id="file_input" type="file"></a>
                        </span>
                        <input class="file_info form-control" placeholder="请上传店铺形象照片" disabled="disabled" type="text">
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <div class="input-group">
                        <span class="input-group-addon">营业时间</span>
                        <input type="text" class="form-control time_select_panel" placeholder="请填写开店时间">
                        <span class="input-group-addon">@</span>
                        <input type="text" class="form-control time_select_panel" placeholder="请填写关店时间">
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <div class="input-group">
                        <span class="input-group-addon">描<br/>述</span>
                        <textarea id="store_info" onclick="value=''">请填写店铺描述</textarea>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="item active" id="result">
                <img src="images/public/wp6.jpg">
            </div>
        </div>
    </div>
    <hr/>
    <div class="row">
        <div class="col-lg-12">
            <div class="input-group">
                <span class="input-group-addon">所属地区</span>
                <select id="s_province" style="width: 100%;" name="s_province"></select>
                <span class="input-group-addon">-</span>
                <select id="s_city" style="width: 100%;" name="s_city" ></select>
                <span class="input-group-addon">-</span>
                <select id="s_county" style="width: 100%;" name="s_county"></select>
            </div>
        </div>    
    </div>
    <div class="row">
        <div class="col-lg-12">
            <div class="input-group" id="r-result">
                <span class="input-group-addon">详细地址</span>
                <input type="text" class="form-control" id="suggestId" placeholder="银盆岭大桥西世茂铂翠湾2期2栋805">
                <div id="searchResultPanel" style="border:1px solid #C0C0C0;width:150px;height:auto; display:none;"></div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12">
            <div id="store-map"></div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12 text-center">
            <a class="btn btn-info" onclick="srcpage('view-platform/store_list.html')">保存</a>
            <a class="btn btn-default"  onclick="srcpage('view-platform/store_list.html')">取消</a>
        </div>
    </div>
</div>
<script type="text/javascript">    
    _init_area();
    $("#s_province").change(function () {
        var province = $("#s_province option:selected").text();
        map.centerAndZoom(province,10);    // 用省会名设置地图中心点
    });
    $("#s_city").change(function () {
        var city = $("#s_city option:selected").text();
        map.centerAndZoom(city,11);        // 用城市名设置地图中心点
    });
    $("#s_county").change(function () {
        var county = $("#s_county option:selected").text();
        map.centerAndZoom(county,16);      // 用地区名设置地图中心点
    });

</script>
<script type="text/javascript">

    // 百度地图API功能
    var map = new BMap.Map("store-map");
    var point = new BMap.Point(112.963847,28.233569);
    var marker = new BMap.Marker(point);  // 创建标注
    map.centerAndZoom(point,18);
    map.enableScrollWheelZoom();   //启用滚轮放大缩小，默认禁用
    map.enableContinuousZoom();    //启用地图惯性拖拽，默认禁用

    function show_store(point) {
        var name = $("#store_name").val();
        var file = $("#result").children("img").attr('src');
        var s_time = $("#store_s_time").val();
        var e_time = $("#store_e_time").val();
        var info = $("#store_info").val();
        var sContent =
        "<h4 class='store_name'>"+ name +"</h4>" + 
        "<img id='imgDemo' src='"+file+"' title='"+name+"'/>" + 
        "<p class='store_info'>"+ info+"</p>" + 
        "<p class='store_info'>营业时间:&nbsp;"+ s_time+"&nbsp;至&nbsp;"+ e_time+"</p>" + 
        "</div>";
        var infoWindow = new BMap.InfoWindow(sContent);  // 创建信息窗口对象
        map.openInfoWindow(infoWindow,point); //开启信息窗口
    }


    //单击获取点击的经纬度
    map.addEventListener("click",function(e){
        map.clearOverlays();    //清除地图上所有覆盖物
        //alert(e.point.lng + "," + e.point.lat);        
        point = new BMap.Point(e.point.lng,e.point.lat);
        var marker = new BMap.Marker(point);  // 创建标注
        map.addOverlay(marker);               // 将标注添加到地图中
        map.centerAndZoom(point,18);
        show_store(point);
    });


    function G(id) {
        return document.getElementById(id);
    }
    var ac = new BMap.Autocomplete(    //建立一个自动完成的对象
        {"input" : "suggestId"
        ,"location" : map
    });

    ac.addEventListener("onhighlight", function(e) {  //鼠标放在下拉列表上的事件
    var str = "";
        var _value = e.fromitem.value;
        var value = "";
        if (e.fromitem.index > -1) {
            value = _value.province +  _value.city +  _value.district +  _value.street +  _value.business;
        }    
        str = "FromItem<br />index = " + e.fromitem.index + "<br />value = " + value;
        
        value = "";
        if (e.toitem.index > -1) {
            _value = e.toitem.value;
            value = _value.province +  _value.city +  _value.district +  _value.street +  _value.business;
        }    
        str += "<br />ToItem<br />index = " + e.toitem.index + "<br />value = " + value;
        G("searchResultPanel").innerHTML = str;
    });

    var myValue;
    ac.addEventListener("onconfirm", function(e) {    //鼠标点击下拉列表后的事件
    var _value = e.item.value;
        myValue = _value.province +  _value.city +  _value.district +  _value.street +  _value.business;
        G("searchResultPanel").innerHTML ="onconfirm<br />index = " + e.item.index + "<br />myValue = " + myValue;
        
        setPlace();
    });

    function setPlace(){
        map.clearOverlays();    //清除地图上所有覆盖物
        function myFun(){
            var pp = local.getResults().getPoi(0).point;    //获取第一个智能搜索的结果
            map.centerAndZoom(pp, 18);
            map.addOverlay(new BMap.Marker(pp));    //添加标注
        }
        var local = new BMap.LocalSearch(map, { //智能搜索
          onSearchComplete: myFun
        });
        local.search(myValue);
    }

    upimg('result','file_input');
    function upimg (resur,file) {
        var result = document.getElementById(resur);
        var input = document.getElementById(file);
        if (typeof FileReader === 'undefined') {
            result.innerHTML = "抱歉，你的浏览器不支持 FileReader";
            input.setAttribute('disabled', 'disabled');
        } else {
            $('#'+file).change(function () {
                $("#resur_show .item").removeClass("active");
                $('#'+resur).addClass("active");
                var file_url =$(this).val();
                $(this).parents(".input-group").find(".file_info").val(file_url);
            });
            input.addEventListener('change', function () {
                var file = this.files[0];
                if (!/image\/\w+/.test(file.type)) {
                    alert("请确保文件为图像类型");
                    return false;
                }
                var reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = function(e) {
                    result.innerHTML = '<img src="' + this.result + '" alt=""/>'; 
                }
            }, false);
        }
    }
</script>
<script type="text/javascript" src="js/public.js"></script>